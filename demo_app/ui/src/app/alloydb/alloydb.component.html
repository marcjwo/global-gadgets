<div class="alloydb-container">
  <div class="header">
    <h1>AlloyDB AI Explorer</h1>
    <p>Select a tile below to execute the query and see the results directly from AlloyDB.</p>
  </div>

  <div class="queries-grid">
    <mat-card *ngFor="let query of queries" class="query-tile" [class.active]="executedQuery === query"
      (click)="executeQuery(query)">
      <mat-card-header>
        <mat-card-title>{{ query.title }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="description">{{ query.description }}</p>
        <button mat-icon-button class="copy-button" (click)="copyQuery(query.queryTemplate, $event)"
          matTooltip="Copy Query SQL">
          <mat-icon>content_copy</mat-icon>
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="results-section" *ngIf="executedQuery || loading">
    <div *ngIf="loading" class="loading-spinner">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Running query...</p>
    </div>

    <div *ngIf="!loading && executedQuery" class="results-container">
      <h2>Results: {{ executedQuery.title }}</h2>
      <p class="explanation-box">
        <strong>Explanation:</strong> {{ executedQuery.description }}
      </p>

      <div *ngIf="queryError" class="error-message">
        <mat-icon>error</mat-icon>
        <span>{{ queryError }}</span>
      </div>

      <div class="table-container" *ngIf="!queryError && queryResult.length > 0">
        <table mat-table [dataSource]="queryResult" class="mat-elevation-z2">
          <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
            <th mat-header-cell *matHeaderCellDef> {{column}} </th>
            <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <div *ngIf="!queryError && queryResult.length === 0" class="no-results">
        No results found.
      </div>

      <div class="raw-query">
        <h3>Executed Query:</h3>
        <pre>{{ getFormattedQuery(executedQuery.queryTemplate) }}</pre>
      </div>
    </div>
  </div>
</div>
